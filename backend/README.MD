# Backend

## Recursos utilizados

- Docker (ContainerizaÃ§Ã£o e isolamento do ambiente de desenvolvimento)
- Zod (ValidaÃ§Ã£o de schemas e tipos em tempo de execuÃ§Ã£o)
- Node.js (Ambiente de execuÃ§Ã£o Javascript server-side)
- Typescript (Superset do Javascript com tipagem estÃ¡tica)
- Prisma (ORM para banco de dados com suporte a migrations e modelagem)
- PostgresSQL (Sistema de gerenciamento de banco de dados relacional)
- Fastify (Framework web rÃ¡pido e eficiente para Node.js)

## ðŸ“‚ Estrutura

```
backend/
â”œâ”€â”€ prisma/                    # ConfiguraÃ§Ãµes e arquivos do Prisma ORM
â”‚   â”œâ”€â”€ migrations/            # MigraÃ§Ãµes do banco de dados
â”‚   â”œâ”€â”€ schema.prisma          # DefiniÃ§Ã£o do esquema do banco de dados
â”‚   â””â”€â”€ seed.ts                # Popular banco com 15 mesas
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ env/                   # Lidar com as variÃ¡veis de ambiente
â”‚   â”œâ”€â”€ http/                  # Lidar com todas as requisiÃ§Ãµes
â”‚   â”‚   â”œâ”€â”€ controllers/       # Controladores para gerenciar as requisiÃ§Ãµes
â”‚   â”‚   â”œâ”€â”€ middlewares/       # Middlewares para validaÃ§Ãµes e autenticaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ routes/            # DefiniÃ§Ã£o das rotas da API
â”‚   â”‚   â””â”€â”€ schemas/           # ValidaÃ§Ã£o da entrada de dados atraves das requisiÃ§Ãµes
â”‚   â”œâ”€â”€ persistence/           # Biblioteca principal de conexÃ£o do banco
â”‚   â”œâ”€â”€ persistence/           # LÃ³gica com query para request ao banco de dados
â”‚   â”œâ”€â”€ services/              # LÃ³gica de negÃ³cios e integraÃ§Ã£o com o banco
â”‚   â”‚   â”œâ”€â”€ errors/            # Classe para lidar com erros e excessÃµes
â”‚   â”‚   â”œâ”€â”€ factories/         # Factories e persistÃªncias para criaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ use_cases/         # Casos de uso relacionados
â”‚   â”œâ”€â”€ utils/                 # FunÃ§Ãµes utilitÃ¡rias e helpers
â”‚   â”œâ”€â”€ index.ts               # Arquivo principal para inicializar o servidor
â”‚   â””â”€â”€ app.ts                 # ConfiguraÃ§Ã£o do servidor (Fastify, middlewares, etc.)
â”œâ”€â”€ .env.example               # Exemplo de variÃ¡veis de ambiente
â”œâ”€â”€ docker-compose.yml         # ConfiguraÃ§Ã£o do Docker para o backend
â”œâ”€â”€ package.json               # DependÃªncias e scripts do backend
â””â”€â”€ tsconfig.json              # ConfiguraÃ§Ã£o do TypeScript
```

## âœ… Checklist de Requisitos Funcionais

### ðŸ§  Backend

- [x] **AutenticaÃ§Ã£o de usuÃ¡rios** (login)
- [x] LÃ³gica para permitir reservas **somente das 18:00 Ã s 23:59**, exceto **aos domingos**
- [x] ValidaÃ§Ã£o para evitar **conflito de horÃ¡rios** entre reservas
- [x] PersistÃªncia de dados com banco de dados **relacional**
- [x] Endpoints/API para:
  - [x] Login
  - [x] Cadastro
  - [x] Criar reserva
  - [x] Listar reservas (para painel admin e usuÃ¡rios)
  - [x] Cancelar reservas
- [x] Popular o banco de dados com dados de teste (manualmente ou via **seeds/factories**)

## Para rodar a aplicaÃ§Ã£o localmente

1.  Abra o terminal dentro da pasta do projeto (./backend) e instale as dependencias;

```bash
npm install
```

Obs: Caso ja tenha o container listado no seu docker, apenas inicie ele e pule pro passo 5:

```bash
docker start reserva-restaurante
```

2. Abra o docker (recomendo usar docker desktop, se nÃ£o tiver, baixe), e encerre todos conteiners que estiver ativo;

```bash
docker-compose down
```

3. Com o terminal aberto (dentro do diretorio ./backend aqui do projeto) digite o comando para iniciar o container docker:

```bash
docker-compose up -d
```

3.1. Confirme se o container reserva-restaurante esta criado

```bash
docker ps
```

![Image](https://github.com/user-attachments/assets/f5f2a6a4-f2c2-4b6b-a2a4-dba8b4ad2f99)

4. Confirme a conexÃ£o com o banco de dados com arquivo .env (crie o arquivo) e aplique conforme o exemplo .env.example

```bash
DATABASE_URL="postgresql://user:docker@localhost:5432/database_name"
```

5. Realiza a migraÃ§Ã£o do banco

```bash
npx prisma migrate dev
```

6. Iniciar o backend;

```bash
npm run dev
```

7. Abra outro terminal para criar as mesas caso nÃ£o tenha nenhuma cadastrada
   **Insere no banco 15 mesas**

```bash
npm run seed
```

8. Caso queira ver o banco de dados online

```bash
npx prisma studio
```

9. Caso deseja apenas testar as rotas com requisiÃ§Ãµes pelo Postman, na raiz deste projeto possui o arquivo ''Reserva_Restaurante_collection.json'' onde contem toda collection necessaria.

Obs: Localmente o banco roda no localhost:3333, o docker no localhost:5432, se atente para que antes de rodar o projeto, essas portas estejam livres.
